<!DOCTYPE html>
<html lang="UTF-8">
<head>
  <meta charset="UTF-8">
  <title>å–®å­—ç®¡ç†å¾Œå°</title>
  <style>
  body {
   font-family: Arial, sans-serif; /* è¨­å®šé è¨­å­—å‹ç‚º Arialï¼Œæ‰¾ä¸åˆ°æ™‚å†ç”¨ç³»çµ±å…§çš„ sans-serif é¡å­—å‹ */
   /*  max-width: 1200px;             è¨­å®šå…§å®¹æœ€å¤§å¯¬åº¦ç‚º 1200pxï¼Œé¿å…å¤ªå¤§è¢å¹•æ™‚å…§å®¹éåº¦å»¶å±• */
    margin: 0px 10px 10px 10px;              /* é ‚éƒ¨ å³é‚Š åº•éƒ¨ å·¦é‚Š;ï¼ˆé †æ™‚é‡é †åºï¼‰ */
  }
    .container {
      display: flex;
      gap: 10px; /*é–“è·*/
    }
    .left-panel {/*å·¦é‚Šçš„è¨­å®š*/
      flex: 1;
    }
    .right-panel {/*å³é‚Šçš„å–®å­—åº«*/
      flex: 1; /*ä½”æ“š1ä»½*/
      position: sticky; /*å›ºå®š*/
      margin-top: -5.0em; /* å°‡æ¨™é¡Œå¾€ä¸Šç§»å‹• 1.5emï¼Œè¦–æƒ…æ³èª¿æ•´ */
      align-self: flex-start; /*é ä¸Š*/
    }
    .word-list {
      max-height: 70vh;
      overflow-y: auto;
      border: 1px solid #ccc;
      padding: 10px;
      border-radius: 5px;
    }
    .word-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 5px;/*å–®å­—çš„padding*/
      border-bottom: 1px solid #eee;/*å–®å­—ä¸‹æ–¹çš„é‚Šæ¡†*/  
    }
    .word-item:last-child {
      border-bottom: none;
    }
    .save-buttons {
      margin: 20px 0;
      padding: 10px;
      background: #f5f5f5;
      border-radius: 5px;
    }
    .save-buttons button {
      margin-right: 10px;
    }
    button {
    padding: 5px 10px;
    cursor: pointer;
    transition: background-color 0.3s ease, opacity 0.3s ease, color 0.3s ease, border-color 0.3s ease; /* ç¢ºä¿æ‰€æœ‰ç›¸é—œå±¬æ€§éƒ½æœ‰éæ¸¡æ•ˆæœ */
    border-radius: 3px; /* çµ¦æŒ‰éˆ•ä¸€å€‹åœ“è§’ */
    /* é€™è£¡ä¸å†è¨­å®šå…·é«”é¡è‰²ï¼Œå› ç‚ºæœƒè¢« .save-button-clean æˆ– .save-button-dirty è¦†è“‹ */
  }

  .save-button-dirty {
    /* éœ€è¦å„²å­˜æ™‚çš„æ·±è‰²æ¨£å¼ */
    background-color: #007bff;
    color: white;
    border: 1px solid #0056b3;
    opacity: 1; /* å®Œå…¨ä¸é€æ˜ */
  }

  .save-button-clean {
    /* å·²å„²å­˜æˆ–ç„¡éœ€å„²å­˜æ™‚çš„æ·ºè‰²æ¨£å¼ */
    background-color: #e0e0e0; /* æ·ºç°è‰² */
    color: #333; /* æ·±è‰²æ–‡å­— */
    border: 1px solid #b0b0b0;
    opacity: 0.7; /* è®Šæ·¡ */
  }

  .danger-button {
      background-color: red;
      color: white;
      border: none;
      padding: 5px 10px;
      border-radius: 3px;
  }
    input[type="text"], input[type="number"] {
      padding: 5px;
      margin: 5px 0;
      width: 200px;
    }
    textarea {
      width: 100%;
      margin: 5px 0;
    }

  </style>
</head>
<body>
  <h1>å–®å­—ç®¡ç†å¾Œå°</h1>
  <p id="saveReminder"></p>  <button id="langToggleBtn" onclick="toggleLanguage()">ğŸŒ åˆ‡æ›èªè¨€</button>
  <div class="container">



    <div class="left-panel">
      <div>
        <input id="wordInput" type="text" placeholder="è‹±æ–‡å–®å­—">
        <input id="translationInput" type="text" placeholder="ä¸­æ–‡ç¿»è­¯">
        <button onclick="addWord()">æ–°å¢å–®å­—</button>
      </div>

      <hr>

      <div>
        <h2>æ‰¹é‡åŒ¯å…¥å–®å­—</h2>
        <textarea id="bulkInput" rows="10" cols="50" placeholder="ä¸€è¡Œä¸€çµ„ï¼Œè‹±æ–‡,ä¸­æ–‡ã€‚ä¾‹å¦‚ï¼šHappy (adj.),é–‹å¿ƒçš„"></textarea><br>
        <button onclick="bulkImport()">æ‰¹é‡åŒ¯å…¥</button>
      </div>

      <hr>

      <div>
        <h2>éŠæˆ²è¨­å®š</h2>
        <label for="wordsPerRound">æ¯å±€å–®å­—æ•¸é‡ï¼š</label>
        <input type="number" id="wordsPerRound" min="1" value="10">
      </div>

      <div class="save-buttons">
        <button id="saveAllButton" onclick="saveAll()">ğŸ’¾å„²å­˜æ‰€æœ‰è¨­å®š</button>
        <button class="danger-button" onclick="clearAllWords()">âŒä¸€éµåˆªé™¤æ‰€æœ‰å–®å­—</button>
      </div>

    </div>

    <div class="right-panel">
      <h2>ç¾æœ‰å–®å­—</h2>
      <div class="word-list" id="wordList"></div>
    </div>
  </div>

  <script>
    const urlParams = new URLSearchParams(window.location.search);
    let currentLanguage = urlParams.get('lang') || 'zh';
  
    let words = JSON.parse(localStorage.getItem('words')) || [];
    let settings = JSON.parse(localStorage.getItem('wordGameSettings')) || { wordsPerRound: 10 };

    // **é‡è¦ä¿®æ­£ï¼šoriginalWords å’Œ originalSettings çš„åˆå§‹åŒ–æ”¾åœ¨ DOMContentLoaded ä¹‹å¾Œ**
    // å› ç‚ºå®ƒå€‘éœ€è¦åŸºæ–¼å·²ç¶“å¾ localStorage è¼‰å…¥çš„ words å’Œ settings ä¾†åšå¿«ç…§ã€‚
    // åœ¨é€™è£¡å…ˆå®£å‘Šï¼Œä½†åœ¨ DOMContentLoaded è£¡è³¦å€¼ã€‚
    let originalWords;
    let originalSettings;

    // **æ–°å¢ç‹€æ…‹è®Šæ•¸å’ŒæŒ‰éˆ•å¼•ç”¨**
    let needsSave = false; // è¿½è¹¤æ˜¯å¦æœ‰æœªå„²å­˜çš„è®Šæ›´
    const saveAllButton = document.getElementById('saveAllButton'); // ç²å–å„²å­˜æŒ‰éˆ•å…ƒç´ 
    const saveReminderElement = document.getElementById('saveReminder'); // ç²å–æç¤ºæ–‡å­—å…ƒç´ 

    // **æ ¹æ“š needsSave ç‹€æ…‹æ›´æ–°æŒ‰éˆ•æ¨£å¼å’Œæç¤ºæ–‡å­—**
    function updateSaveButtonState() {
      const t = translations[currentLanguage];
      if (needsSave) {
        saveAllButton.classList.remove('save-button-clean');
        saveAllButton.classList.add('save-button-dirty');
        saveReminderElement.textContent = t.reminder; // é¡¯ç¤ºæç¤ºæ–‡å­—
      } else {
        saveAllButton.classList.remove('save-button-dirty');
        saveAllButton.classList.add('save-button-clean');
        saveReminderElement.textContent = ''; // æ¸…ç©ºæç¤ºæ–‡å­—
      }
    }

    // **æ¨™è¨˜ç‚ºéœ€è¦å„²å­˜çš„å‡½å¼ - å¢åŠ æ•¸æ“šæ¯”è¼ƒé‚è¼¯**
    function markAsNeedsSave() {
      // åœ¨é€™è£¡é‡æ–°ç¢ºä¿ currentSettings.wordsPerRound å–å¾—çš„æ˜¯è¼¸å…¥æ¡†çš„ç•¶å‰å€¼
      // è€Œä¸æ˜¯ settings ç‰©ä»¶ä¸­å¯èƒ½èˆŠçš„å€¼
      const currentWordsString = JSON.stringify(words);
      const currentWordsPerRound = parseInt(document.getElementById('wordsPerRound').value);
      
      // æ§‹å»ºä¸€å€‹è‡¨æ™‚çš„ settings ç‰©ä»¶ä¾†é€²è¡Œæ¯”è¼ƒ
      const currentSettings = { ...settings, wordsPerRound: currentWordsPerRound };
      const currentSettingsString = JSON.stringify(currentSettings);


      const originalWordsString = JSON.stringify(originalWords);
      const originalSettingsString = JSON.stringify(originalSettings); // é€™æ˜¯æ•´å€‹ settings ç‰©ä»¶çš„å­—ç¬¦ä¸²

      const hasChanges = (currentWordsString !== originalWordsString) || (currentSettingsString !== originalSettingsString);

      if (hasChanges && !needsSave) {
        needsSave = true;
        updateSaveButtonState();
      } else if (!hasChanges && needsSave) {
        // å¦‚æœç¾åœ¨æ²’æœ‰è®ŠåŒ–ï¼Œä½†ä¹‹å‰æ¨™è¨˜ç‚ºéœ€è¦å„²å­˜ï¼Œå‰‡æ›´æ–°ç‹€æ…‹ç‚ºä¸éœ€è¦å„²å­˜
        needsSave = false;
        updateSaveButtonState();
      }
      // å¦‚æœæ²’æœ‰è®ŠåŒ–ï¼Œä¸¦ä¸”å·²ç¶“æ˜¯ 'clean' ç‹€æ…‹ï¼Œå‰‡ä¸è§¸ç™¼ä»»ä½•æ“ä½œ
      // å¦‚æœæœ‰è®ŠåŒ–ï¼Œä¸¦ä¸”å·²ç¶“æ˜¯ 'dirty' ç‹€æ…‹ï¼Œå‰‡ä¸è§¸ç™¼ä»»ä½•æ“ä½œ
    }

    function renderWords() {
        const wordList = document.getElementById('wordList');
        wordList.innerHTML = '';
        words.forEach((item, index) => {
            const div = document.createElement('div');
            div.className = 'word-item';
            div.textContent = `${item.word} - ${item.translation}`;
            const deleteBtn = document.createElement('button');
            deleteBtn.textContent = translations[currentLanguage].delete;
            deleteBtn.onclick = () => {
                words.splice(index, 1);
                renderWords(); // åˆªé™¤å¾Œé‡æ–°æ¸²æŸ“
                markAsNeedsSave(); // åˆªé™¤å–®å­—å¾Œæ¨™è¨˜ç‚ºéœ€è¦å„²å­˜
            };
            div.appendChild(deleteBtn);
            wordList.appendChild(div);
        });
    }

    function addWord() {
        const word = document.getElementById('wordInput').value.trim();
        const translation = document.getElementById('translationInput').value.trim();
        const t = translations[currentLanguage];
        if (word && translation) {
            words.push({ word, translation });
            document.getElementById('wordInput').value = '';
            document.getElementById('translationInput').value = '';
            renderWords();
            markAsNeedsSave(); // æ–°å¢å–®å­—å¾Œæ¨™è¨˜ç‚ºéœ€è¦å„²å­˜
        } else {
            console.log(t.alertInputRequired); // ç§»é™¤ alertï¼Œæ”¹ç‚º console.log æˆ–å…¶ä»–è¦–è¦ºæç¤º
        }
    }

    function bulkImport() {
        const t = translations[currentLanguage];
        const inputText = document.getElementById('bulkInput').value.trim();
        if (!inputText) {
            console.log(t.alertPasteRequired); // ç§»é™¤ alertï¼Œæ”¹ç‚º console.log æˆ–å…¶ä»–è¦–è¦ºæç¤º
            return;
        }
        const initialWordsCount = words.length; // è¨˜éŒ„åŒ¯å…¥å‰çš„å–®å­—æ•¸é‡

        const lines = inputText.split('\n');
        for (const line of lines) {
            const [word, translation] = line.split(',').map(s => s.trim());
            if (word && translation) {
                words.push({ word, translation });
            }
        }
        document.getElementById('bulkInput').value = '';
        renderWords();
        if (words.length > initialWordsCount) { // å¦‚æœå¯¦éš›åŒ¯å…¥äº†æ–°çš„å–®å­—
            markAsNeedsSave(); // æ‰¹é‡åŒ¯å…¥å¾Œæ¨™è¨˜ç‚ºéœ€è¦å„²å­˜
            console.log(t.alertImportDone); // ç§»é™¤ alertï¼Œæ”¹ç‚º console.log
        }
    }

    function saveWords() {
        localStorage.setItem('words', JSON.stringify(words));
    }

    function saveSettings() {
        const wordsPerRoundInput = document.getElementById('wordsPerRound');
        const newWordsPerRound = parseInt(wordsPerRoundInput.value); 
        const t = translations[currentLanguage];

        // æª¢æŸ¥æ˜¯å¦æ˜¯æœ‰æ•ˆçš„æ•¸å­—ï¼Œä¸”å¤§æ–¼ç­‰æ–¼1
        if (isNaN(newWordsPerRound) || newWordsPerRound < 1) {
            console.log(t.alertInvalidNumber); 
            wordsPerRoundInput.value = settings.wordsPerRound; // é‡ç½®è¼¸å…¥æ¡†çš„å€¼ç‚ºä¹‹å‰æœ‰æ•ˆå€¼
            // ä¸å‘¼å« markAsNeedsSaveï¼Œå› ç‚ºæ­¤æ™‚æ²’æœ‰å¯¦éš›çš„æ•¸æ“šæ”¹è®Š
            return; 
        }

        // **é‡è¦ä¿®æ­£ï¼šåªæœ‰ç•¶ settings.wordsPerRound èˆ‡ newWordsPerRound ç¢ºå¯¦ä¸åŒæ™‚æ‰æ›´æ–°ä¸¦å„²å­˜**
        if (settings.wordsPerRound !== newWordsPerRound) {
            settings.wordsPerRound = newWordsPerRound; // æ›´æ–° settings ç‰©ä»¶
            localStorage.setItem('wordGameSettings', JSON.stringify(settings)); // å„²å­˜åˆ° localStorage
            markAsNeedsSave(); // è¨­å®šæ”¹è®Šå¾Œæ¨™è¨˜ç‚ºéœ€è¦å„²å­˜
        }
        // å¦‚æœå€¼æ²’æœ‰æ”¹è®Šï¼Œå‰‡ä¸åŸ·è¡Œä»»ä½•æ“ä½œï¼Œä¹Ÿä¸å‘¼å« markAsNeedsSave
    }

    function clearAllWords() {
        const t = translations[currentLanguage];
        if (confirm(t.confirmDeleteAll)) {
            words = [];
            localStorage.removeItem('words');
            renderWords();
            markAsNeedsSave(); // æ¸…ç©ºå–®å­—å¾Œæ¨™è¨˜ç‚ºéœ€è¦å„²å­˜
            console.log(t.alertDeleteAllDone); 
        }
    }

    function saveAll() {
      // åªæœ‰ç•¶ needsSave ç‚º true æ™‚æ‰åŸ·è¡Œå„²å­˜é‚è¼¯
      if (!needsSave) {
        console.log(translations[currentLanguage].alertNoChangesToSave || "æ²’æœ‰è®Šæ›´éœ€è¦å„²å­˜ã€‚");
        return;
      }

      saveWords();    // å„²å­˜å–®å­—åˆ—è¡¨
      saveSettings(); // å„²å­˜éŠæˆ²è¨­å®š

      // **é‡è¦ä¿®æ­£ï¼šå„²å­˜æˆåŠŸå¾Œï¼Œæ›´æ–°åŸå§‹æ•¸æ“šå¿«ç…§**
      originalWords = JSON.parse(JSON.stringify(words));
      originalSettings = JSON.parse(JSON.stringify(settings));

      // å„²å­˜æˆåŠŸå¾Œï¼Œå°‡ç‹€æ…‹è¨­ç‚ºå·²å„²å­˜ï¼Œä¸¦æ›´æ–°æŒ‰éˆ•æ¨£å¼
      needsSave = false; 
      updateSaveButtonState(); 
      console.log(translations[currentLanguage].alertSaveDone);
    }

    const translations = {
        zh: {
            title: 'å–®å­—ç®¡ç†å¾Œå°',
            addWord: 'æ–°å¢å–®å­—',
            placeholderWord: 'è‹±æ–‡å–®å­—',
            placeholderTranslation: 'æ„æ€æˆ–ç¿»è­¯',
            bulkTitle: 'æ‰¹é‡åŒ¯å…¥å–®å­—',
            bulkPlaceholder: 'ä¸€è¡Œä¸€çµ„ï¼Œè‹±æ–‡,ä¸­æ–‡ã€‚ä¾‹å¦‚ï¼šHappy (adj.),é–‹å¿ƒçš„',
            bulkImport: 'æ‰¹é‡åŒ¯å…¥',
            save: 'ğŸ’¾å„²å­˜æ‰€æœ‰è¨­å®š', 
            clear: 'âŒä¸€éµåˆªé™¤æ‰€æœ‰å–®å­—',
            wordListTitle: 'ç¾æœ‰å–®å­—',
            delete: 'åˆªé™¤',
            reminder: 'ğŸ”” æ‚¨æœ‰æœªå„²å­˜çš„è®Šæ›´ï¼è«‹é»æ“Šã€ğŸ’¾å„²å­˜æ‰€æœ‰è¨­å®šã€‘', 
            alertInputRequired: 'è«‹è¼¸å…¥è‹±æ–‡å’Œä¸­æ–‡',
            alertPasteRequired: 'è«‹è²¼ä¸Šè¦åŒ¯å…¥çš„å–®å­—',
            alertImportDone: 'æ‰¹é‡åŒ¯å…¥å®Œæˆï¼',
            alertSaveDone: 'å„²å­˜æˆåŠŸï¼',
            confirmDeleteAll: 'ç¢ºå®šè¦åˆªé™¤æ‰€æœ‰å–®å­—å—ï¼Ÿé€™å€‹å‹•ä½œç„¡æ³•å¾©åŸï¼',
            alertDeleteAllDone: 'å·²æ¸…ç©ºæ‰€æœ‰å–®å­—ï¼',
            settingsTitle: 'éŠæˆ²è¨­å®š',
            wordsPerRound: 'æ¯å±€å–®å­—æ•¸é‡ï¼š',
            alertInvalidNumber: 'è«‹è¼¸å…¥æœ‰æ•ˆçš„æ•¸å­—ï¼',
            alertNoChangesToSave: 'æ²’æœ‰è®Šæ›´éœ€è¦å„²å­˜ã€‚',
        },
        en: {
            title: 'Word Management',
            addWord: 'Add Word',
            placeholderWord: 'English Word',
            placeholderTranslation: 'Meaning or translation',
            bulkTitle: 'Bulk Import Words',
            bulkPlaceholder: 'One line per pair, e.g.: Happy (adj.),Feeling good',
            bulkImport: 'Bulk Import',
            save: 'ğŸ’¾ Save All Settings', 
            clear: 'âŒ Delete All Words',
            wordListTitle: 'Current Words',
            delete: 'Delete',
            reminder: 'ğŸ”” You have unsaved changes! Click ã€ğŸ’¾ Save All Settingsã€‘', 
            alertInputRequired: 'Please enter both English and Chinese.',
            alertPasteRequired: 'Please paste the words to import.',
            alertImportDone: 'Bulk import completed!',
            alertSaveDone: 'Saved successfully!',
            confirmDeleteAll: 'Are you sure you want to delete all words? This cannot be undone!',
            alertDeleteAllDone: 'All words have been cleared!',
            settingsTitle: 'Game Settings',
            wordsPerRound: 'Words per round:',
            alertInvalidNumber: 'Please enter a valid number!',
            alertNoChangesToSave: 'No changes to save.',
        }
    };

    function toggleLanguage() {
        currentLanguage = currentLanguage === 'zh' ? 'en' : 'zh';
        updateLanguage();
    }

    function updateLanguage() {
        const t = translations[currentLanguage];
        document.title = t.title;
        document.querySelector('h1').textContent = t.title;
        document.querySelector('button[onclick="addWord()"]').textContent = t.addWord;
        document.getElementById('wordInput').placeholder = t.placeholderWord;
        document.getElementById('translationInput').placeholder = t.placeholderTranslation;
        document.querySelectorAll('h2')[0].textContent = t.bulkTitle;
        document.getElementById('bulkInput').placeholder = t.bulkPlaceholder;
        document.querySelector('button[onclick="bulkImport()"]').textContent = t.bulkImport;
        saveAllButton.textContent = t.save; 
        document.querySelector('button[onclick="clearAllWords()"]').textContent = t.clear;
        document.querySelectorAll('h2')[1].textContent = t.settingsTitle;
        document.querySelectorAll('h2')[2].textContent = t.wordListTitle;
        document.getElementById('langToggleBtn').textContent = 'ğŸŒ ' + (currentLanguage === 'zh' ? 'English' : 'ä¸­æ–‡');
        document.querySelector('label[for="wordsPerRound"]').textContent = t.wordsPerRound;

        renderWords();
        updateSaveButtonState(); // ç¢ºä¿æ›´æ–°èªè¨€å¾Œï¼ŒæŒ‰éˆ•ç‹€æ…‹ä¹Ÿæ­£ç¢ºæ›´æ–°
    }

    function openWordBank() {
        window.open(`å–®å­—åº«.html?lang=${currentLanguage}`, '_blank');
    }

    // é é¢å®Œå…¨è¼‰å…¥å¾ŒåŸ·è¡Œåˆå§‹åŒ–
    document.addEventListener('DOMContentLoaded', () => {
        // **é‡è¦ä¿®æ­£ï¼šåœ¨è¨­å®šè¼¸å…¥æ¡†çš„å€¼å’Œè¨­å®šå¿«ç…§ä¹‹å‰ï¼Œç¢ºä¿ settings ç‰©ä»¶å·²ç¶“å¾ localStorage è¼‰å…¥**
        // words å’Œ settings å·²ç¶“åœ¨ script é ‚éƒ¨è¼‰å…¥ï¼Œé€™è£¡åªæ˜¯ç¢ºä¿å®ƒå€‘è¢«æ­£ç¢ºä½¿ç”¨
        document.getElementById('wordsPerRound').value = settings.wordsPerRound;

        // **åˆå§‹åŒ–åŸå§‹æ•¸æ“šçš„å¿«ç…§**
        originalWords = JSON.parse(JSON.stringify(words));
        originalSettings = JSON.parse(JSON.stringify(settings));

        // ç›£è½å–®å­—è¼¸å…¥æ¡†çš„è®ŠåŒ–
        document.getElementById('wordInput').addEventListener('input', markAsNeedsSave);
        document.getElementById('translationInput').addEventListener('input', markAsNeedsSave);
        document.getElementById('bulkInput').addEventListener('input', markAsNeedsSave);

        // ç›£è½æ¯å±€å–®å­—æ•¸é‡è¼¸å…¥æ¡†çš„è®ŠåŒ–
        // é€™è£¡ä¸éœ€è¦å‘¼å« markAsNeedsSaveï¼Œå› ç‚º saveSettings å·²ç¶“è™•ç†äº†
        document.getElementById('wordsPerRound').addEventListener('input', markAsNeedsSave);


        // åˆå§‹åŒ–é é¢èªè¨€å’Œå–®å­—åˆ—è¡¨ï¼ŒåŒæ™‚è¨­å®šåˆå§‹æŒ‰éˆ•ç‹€æ…‹
        // é€™è£¡æœƒè§¸ç™¼ renderWords() å’Œ updateSaveButtonState()
        // ç¢ºä¿åˆå§‹ç‹€æ…‹ç‚º clean
        needsSave = false; // å¼·åˆ¶è¨­å®šç‚º falseï¼Œå› ç‚ºå‰›è¼‰å…¥çš„æ•¸æ“šæ˜¯å·²å„²å­˜çš„
        updateLanguage(); // é€™æœƒå‘¼å« renderWords() ä¸¦å†æ¬¡è§¸ç™¼ updateSaveButtonState()
    });

</script>
</body>
</html>
